/**
 * app-grid
 * @version v0.0.1 - 2014-09-18
 * @link https://github.com/angular-components/app-grid
 * @author  <>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";function widgetEffects(a){$(a).draggable({revert:!0,zIndex:2e3,cursor:"crosshair",handle:".box-name",opacity:.8}).droppable({tolerance:"pointer",drop:function(a,b){{var c=b.draggable,d=$(this);c.position(),d.position()}c.swap(d)}}).on("click",".collapse-link",function(a){a.preventDefault();var b=$(this).closest("div.box"),c=$(this).find("i"),d=b.find("div.box-content");d.slideToggle("fast"),c.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),setTimeout(function(){b.resize(),b.find("[id^=map-]").resize()},50)}).on("click",".close-link",function(a){a.preventDefault();var b=$(this).closest("div.box");b.remove()}).on("click",".expand-link",function(a){var b=$("body");a.preventDefault();var c=$(this).closest("div.box"),d=$(this).find("i");d.toggleClass("fa-expand").toggleClass("fa-compress"),c.toggleClass("expanded"),b.toggleClass("body-expanded");var e=0;b.hasClass("body-expanded")&&(e=100),setTimeout(function(){c.toggleClass("expanded-padding")},e)})}angular.module("angular-components.appGrid",["ngGrid","angular-loading-bar","pascalprecht.translate"]).config(["cfpLoadingBarProvider",function(a){a.includeBar=!1,a.includeSpinner=!0}]).run(["$templateCache",function(a){a.put("gridTemplate.html",'<div class="ngTopPanel" ng-class="{\'ui-widget-header\':jqueryUITheme, \'ui-corner-top\': jqueryUITheme}" ng-style="topPanelStyle()">\r\n    <div class="ngGroupPanel" ng-show="showGroupPanel()" ng-style="groupPanelStyle()">\r\n        <div class="ngGroupPanelDescription" ng-show="configGroups.length == 0">{{i18n.ngGroupPanelDescription}}</div>\r\n        <ul ng-show="configGroups.length > 0" class="ngGroupList">\r\n            <li class="ngGroupItem" ng-repeat="group in configGroups">\r\n                <span class="ngGroupElement">\r\n                    <span class="ngGroupName">{{group.displayName}}\r\n                        <span ng-click="removeGroup($index)" class="ngRemoveGroup">x</span>\r\n                    </span>\r\n                    <span ng-hide="$last" class="ngGroupArrow"></span>\r\n                </span>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    <div class="ngHeaderContainer" ng-style="headerStyle()">\r\n        <div ng-header-row class="ngHeaderScroller" ng-style="headerScrollerStyle()"></div>\r\n    </div>\r\n    <div ng-grid-menu></div>\r <div class="ngHeaderContainer" ng-style="appFilterStyle()" ng-show="showFilterToolbar==\'true\'">\r\n        <div app-filter-grid class="ngHeaderScroller" ng-style="appFilterStyle()"></div>\r\n    </div>\r\n</div>\r\n<div class="ngViewport" unselectable="on" ng-viewport ng-class="{\'ui-widget-content\': jqueryUITheme}" ng-style="viewportStyle()">\r\n    <div class="ngCanvas" ng-style="canvasStyle()">\r\n        <div ng-style="rowStyle(row)" ng-repeat="row in renderedRows" ng-click="row.toggleSelected($event)" ng-class="row.alternatingRowClass()" ng-row></div>\r\n    </div>\r\n</div>\r\n<div ng-grid-footer></div>\r\n'),a.put("app-grid-template.html",'<div class="box ui-draggable ui-droppable">   <div class="box-header">       <div class="box-name">           <i class="fa fa-list-alt"></i>           <span>{{title}}</span>       </div>       <div class="box-icons">           <toolbar-icon class="xls" ng-click="excelExport()" title-key="excel.download">           </toolbar-icon>           <a class="collapse-link">               <i class="fa fa-chevron-up"></i>           </a>           <a class="expand-link">               <i class="fa fa-expand"></i>           </a>           <a class="close-link">               <i class="fa fa-times"></i>           </a>       </div>       <div class="no-move"></div>   </div>   <div class="box-content">       <div class="gridStyle" ng-grid="options" ng-style="gridStyle"></div>   </div></div>'),a.put("footerTemplate.html",'<div ng-show="showFooter" class="ngFooterPanel" ng-class="{\'ui-widget-content\': jqueryUITheme, \'ui-corner-bottom\': jqueryUITheme}" ng-style="footerStyle()"><div class="ngTotalSelectContainer" ><div class="ngFooterTotalItems" ng-class="{\'ngNoMultiSelect\': !multiSelect}" ><span class="ngLabel">{{i18n.ngTotalItemsLabel}} {{maxRows()}}</span><span ng-show="filterText.length > 0" class="ngLabel">({{i18n.ngShowingItemsLabel}} {{totalFilteredItemsLength()}})</span></div><div class="ngFooterSelectedItems" ng-show="multiSelect"><span class="ngLabel">{{i18n.ngSelectedItemsLabel}} {{selectedItems.length}}</span></div></div><div class="ngPagerContainer" style="float: right; margin-top: 10px;" ng-show="enablePaging" ng-class="{\'ngNoMultiSelect\': !multiSelect}"><div style="float:left; margin-right: 10px;" class="ngRowCountPicker"><span style="float: left; margin-top: 3px;" class="ngLabel">{{i18n.ngPageSizeLabel}}</span><select ui-select2 style="float: left;height: 27px; width: 60px" ng-model="pagingOptions.pageSize"><option value=""></option><option ng-repeat="size in pagingOptions.pageSizes">{{size}}</option></select></div><div style="float:left; margin-right: 10px; line-height:25px;" class="ngPagerControl" style="float: left; min-width: 135px;"><button type="button" class="btn btn-default" ng-click="pageToFirst()" ng-disabled="cantPageBackward()" title="{{i18n.ngPagerFirstTitle}}"><span class="fa fa-fast-backward"></span></button><button type="button" class="btn btn-default" ng-click="pageBackward()" ng-disabled="cantPageBackward()" title="{{i18n.ngPagerPrevTitle}}"><span class="fa fa-step-backward"></span></button><input class="ngPagerCurrent form-control" min="1" max="{{currentMaxPages}}" type="number" style="width:50px; height: 24px; margin-top: 1px; padding: 0 4px; display: inline;" ng-model="pagingOptions.currentPage"/><span class="ngGridMaxPagesNumber" ng-show="maxPages() > 0">/ {{maxPages()}}</span><button type="button" class="btn btn-default" ng-click="pageForward()" ng-disabled="cantPageForward()" title="{{i18n.ngPagerNextTitle}}"><span class="fa fa-step-forward"></span></button><button type="button" class="btn btn-default" ng-click="pageToLast()" ng-disabled="cantPageToLast()" title="{{i18n.ngPagerLastTitle}}"><span class="fa fa-fast-forward"></span></button></div></div></div>'),a.put("headerRowTemplate.html",'<div ng-style="{ height: col.headerRowHeight }" ng-repeat="col in renderedColumns" ng-class="col.colIndex()" class="ngHeaderCell"><div class="ngVerticalBar" ng-style="{height: col.headerRowHeight}" ng-class="{ ngVerticalBarVisible: !$last }">&nbsp;</div><div ng-header-cell></div></div>')}]).factory("GridTranslateService",["$cookieStore","$translate",function(a,b){return{translate:function(a,c,d){if(!(void 0==a||null==a||void 0==a.length||a.length<1)){for(var e=0;e<a.length;e++)void 0!=c&&a[e].field.toLowerCase()==c.columnName.toLowerCase()&&(a[e].visible=c.visible),a[e].displayName.indexOf("ROW_NUM")>0?(a[e].displayName=b.instant("grid.rownum.label"),a[e].sortable=!1):a[e].displayName=b.instant(a[e].displayName),"java.util.Date"==a[e].fieldType&&(a[e].cellFilter="date:'"+d.date+"'");return a}}}}]).directive("toolbarIcon",["$translate",function(a){return{restrict:"EA",scope:{"class":"@",titleKey:"@"},link:function(b,c){$(c).html("<a class='"+b.class+"'  title='"+a.instant(b.titleKey)+"'><i class='"+b.class+"'></i></a>")}}}]).directive("appGrid",["$compile","$templateCache","$http","$resource","$translate","GridTranslateService","$timeout",function(a,b,c,d,e,f){return{restrict:"E",scope:{url:"=",downloadUrl:"=",customOptions:"=",filter:"=",refreshFunction:"=",onSelectItem:"=",autoHeight:"=",doPagination:"=",doGrouping:"=",groupCols:"=",key:"=",showRowNum:"=",showFilterToolbar:"=",resizeFunction:"=",footerTemplate:"=",headerRowTemplate:"="},controller:function(a,b,c,d,e){a.showFilter=!1,a.pagingOptions={},a.selectedItem={},a.excelExport=function(){for(var b={page:1,size:1e9,filters:a.filter,sort:[{}]},c=0;c<a.sortOptions.fields.length;c++){var d=a.sortOptions.fields[c].split(".");if(1==d.length)b.sort[c][a.sortOptions.fields[c]]=a.sortOptions.directions[c];else for(var e=0;e<d.length;e++)e+1<d.length?b.sort[c][d[e]]={}:b.sort[c][a.sortOptions.fields[c]]=a.sortOptions.directions[c]}},a.displayedData=[],a.totalServerItems=0,a.dummy=function(){},a.sortOptions={fields:[],directions:[]},a.gridStyle={},a.initSort=function(){return void 0!=a.columnDefs&&Object.keys(a.columnDefs).length>0&&(a.sortOptions.fields[0]=a.columnDefs[1].field),a.sortOptions.directions[0]="desc",a.sortOptions},a.afterSelection=function(b){1==b.selected&&angular.isFunction(a.onSelectItem)&&(b.entity.hasOwnProperty(a.primaryKeyName.toLowerCase())||b.entity.hasOwnProperty(a.primaryKeyName))&&(b.entity.hasOwnProperty(a.primaryKeyName)?a.onSelectItem(b.entity[a.primaryKeyName],b.entity):b.entity.hasOwnProperty(a.primaryKeyName.toLowerCase())&&a.onSelectItem(b.entity[a.primaryKeyName.toLowerCase()],b.entity))},a.getList=function(b){for(var d={page:b,size:a.pagingOptions.pageSize,filters:a.filter,sort:[{}]},g=0;g<a.sortOptions.fields.length;g++){var h=a.sortOptions.fields[g].split(".");if(1==h.length)d.sort[g][a.sortOptions.fields[g]]=a.sortOptions.directions[g];else for(var i=0;i<h.length;i++)i+1<h.length?d.sort[g][h[i]]={}:d.sort[g][a.sortOptions.fields[g]]=a.sortOptions.directions[g]}c({url:a.url,method:"GET",params:d,data:{key:a.key,typeConfiguration:"grid"}}).success(function(b){if(b.hasOwnProperty("configuration.notfound")){var c=e.instant("errors.configuration.notfound")+a.key;return console.error(c),void(a.title=c)}if(a.totalServerItems=b.data.totalElements,a.displayedData=b.data,void 0==a.columnDefs){var d=void 0;null!=b.meta&&null!=b.meta.properties&&void 0!=b.meta.properties.primaryKey&&""!=b.meta.properties.primaryKey&&null!=b.meta.properties.primaryKey&&(d=b.meta.properties.primaryKey,a.primaryKeyName=b.meta.properties.primaryKey.columnName),a.columnDefs=f.translate(b.meta.properties,d,a.$root.locale)}a.columnDefs[0].visible=a.showRowNum===!0,a.columnDefs[0].displayName.indexOf("ROW_NUM")>0&&(a.columnDefs[0].width=40),a.title=e.instant(b.meta.title)})},a.resizeGrid=function(b){var c=angular.element("."+b).scope(),d=void 0==c.topPanelHeight()?32:c.topPanelHeight(),e=1==c.showFooter?void 0==c.footerRowHeight?55:c.footerRowHeight:0,f=void 0==c.rowHeight?30:c.rowHeight,g=void 0==c.renderedRows.length?0:c.renderedRows.length,h=d+e+f*g+5;h=0==g?h+20:h;var i=$("."+b).width();a.gridStyle.height=h+"px",a.doGrouping&&$.each(a.columnDefs,function(b){a.columnDefs[b].width=(i-25)/a.columnDefs.length}),c.adjustScrollLeft(),c.adjustScrollTop(),a.$$postDigest(a.layoutPlugin.updateGridLayout)},a.refreshGrid=function(b){void 0==b&&(b=1),a.selectedItem={},a.options.selectedItems=[],a.getList(b),a.pagingOptions.currentPage=b,"$apply"!=a.$root.$$phase&&"$digest"!=a.$root.$$phase&&a.$apply()},window.ngGrid.i18n.ro={ngTotalItemsLabel:"Total: ",ngPageSizeLabel:""};var g=a.customOptions,h={columnDefs:"columnDefs",data:"displayedData.content"};a.pagingOptions={pageSizes:[5,10,20,30],pageSize:10,totalServerItems:0,currentPage:1};var i={selectedItems:a.selectedItems,enablePaging:0!=a.doPagination,multiSelect:!1,showFooter:!0,pagingOptions:a.pagingOptions,sortInfo:a.sortOptions,totalServerItems:"totalServerItems",useExternalSorting:!0,enableColumnResize:!0,i18n:"ro",jqueryUITheme:!0,showFilter:a.showFilter,afterSelectionChange:a.afterSelection,footerTemplate:a.footerTemplate,headerRowTemplate:a.headerRowTemplate,resizable:!0},j={groups:a.groupCols,groupsCollapsedByDefault:!1};a.layoutPlugin=new ngGridLayoutPlugin,a.$watch("pagingOptions",function(b,c){b===c||b.currentPage===c.currentPage&&b.pageSize===c.pageSize||a.refreshGrid(b.currentPage)},!0),a.$watch("sortOptions",function(b,c){b!==c&&c.fields.length>0&&a.refreshGrid(a.pagingOptions.currentPage)},!0),a.$watch("filter",function(b,c){b!==c&&a.refreshGrid(a.pagingOptions.currentPage)},!0),a.$watch("key",function(b,c){b!==c&&a.refreshGrid(a.pagingOptions.currentPage)},!0),a.$watch("columnDefs",function(){a.initSort()}),a.$on("ngGridEventSorted",function(b,c){angular.equals(c,a.options.sortInfo)||(a.sortOptions=angular.copy(c),a.options.sortInfo=angular.copy(c))}),a.options={plugins:[a.layoutPlugin]},angular.extend(a.options,i),angular.extend(a.options,g),angular.extend(a.options,h),a.doGrouping&&angular.extend(a.options,j),a.refreshGrid(a.pagingOptions.currentPage)},link:function(a,b){widgetEffects($(b)),a.resizeFunction=function(){var a=$(b).closest("div.box");a.resize()},$(b).resize(function(){console.log("resize grid")}),$(window).resize(function(){console.log("resize grid")}),$(".show-sidebar").on("click",function(){window.setTimeout(function(){var a=$($(b)).find(".ngTopPanel");a.resize()},100)}),window.setTimeout(function(){a.options.plugins[0].updateGridLayout()},200)},compile:function(){return{pre:function(c,d){0===d.children().length&&d.append(a(b.get("app-grid-template.html"))(c))}}},replace:!0,transclude:!1}}]);